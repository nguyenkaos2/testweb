

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>22. open Function &mdash; Python Tips 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Python Tips 0.1 documentation" href="index.html"/>
        <link rel="next" title="23. Targeting Python 2+3" href="targeting_python_2_3.html"/>
        <link rel="prev" title="21. Python C extensions" href="python_c_extension.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Python Tips
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="CaoNotes.html">1. *args and **kwargs</a></li>
<li class="toctree-l1"><a class="reference internal" href="args_and_kwargs.html">2. *args and **kwargs</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">3. Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="generators.html">4. Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="map_filter.html">5. Map, Filter and Reduce</a></li>
<li class="toctree-l1"><a class="reference internal" href="set_-_data_structure.html">6. <code class="docutils literal"><span class="pre">set</span></code> Data Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="ternary_operators.html">7. Ternary Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="decorators.html">8. Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="global_&amp;_return.html">9. Global &amp; Return</a></li>
<li class="toctree-l1"><a class="reference internal" href="mutation.html">10. Mutation</a></li>
<li class="toctree-l1"><a class="reference internal" href="__slots__magic.html">11. __slots__ Magic</a></li>
<li class="toctree-l1"><a class="reference internal" href="virtual_environment.html">12. Virtual Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="collections.html">13. Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="enumerate.html">14. Enumerate</a></li>
<li class="toctree-l1"><a class="reference internal" href="object_introspection.html">15. Object introspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="comprehensions.html">16. Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="exceptions.html">17. Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="lambdas.html">18. Lambdas</a></li>
<li class="toctree-l1"><a class="reference internal" href="one_liners.html">19. One-Liners</a></li>
<li class="toctree-l1"><a class="reference internal" href="for_-_else.html">20. For - Else</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_c_extension.html">21. Python C extensions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">22. <code class="docutils literal"><span class="pre">open</span></code> Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="targeting_python_2_3.html">23. Targeting Python 2+3</a></li>
<li class="toctree-l1"><a class="reference internal" href="coroutines.html">24. Coroutines</a></li>
<li class="toctree-l1"><a class="reference internal" href="function_caching.html">25. Function caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="context_managers.html">26. Context managers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Python Tips</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>22. <code class="docutils literal"><span class="pre">open</span></code> Function</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/open_function.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="open-function">
<h1>22. <code class="docutils literal"><span class="pre">open</span></code> Function<a class="headerlink" href="#open-function" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="http://docs.python.org/dev/library/functions.html#open">open</a> opens
a file. Pretty simple, eh? Most of the time, we see it being used like
this:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;photo.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span>
<span class="n">jpgdata</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<p>The reason I am writing this article is that most of the time, I see
open used like this. There are <strong>three</strong> errors in the above code. Can
you spot them all? If not, read on. By the end of this article, you’ll
know what’s wrong in the above code, and, more importantly, be able to
avoid these mistakes in your own code. Let’s start with the basics:</p>
<p>The return value from <code class="docutils literal"><span class="pre">open</span></code> is a file handle, given out from the operating system
to your Python application. You will want to return this file handle
once you’re finished with the file, if only so that your application
won’t reach the limit of the number of open file handles it can have at
once.</p>
<p>Explicitly calling <code class="docutils literal"><span class="pre">close</span></code> closes the file handle, but only if the
read was successful. If there is any error just after <code class="docutils literal"><span class="pre">f</span> <span class="pre">=</span> <span class="pre">open(...)</span></code>,
<code class="docutils literal"><span class="pre">f.close()</span></code> will not be called (depending on the Python interpreter,
the file handle may still be returned, but that’s another story). To
make sure that the file gets closed whether an exception occurs or not,
pack it into a <code class="docutils literal"><span class="pre">with</span></code> statement:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;photo.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">jpgdata</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</pre></div>
</div>
<p>The first argument of <code class="docutils literal"><span class="pre">open</span></code> is the filename. The second one (the
<em>mode</em>) determines <em>how</em> the file gets opened.</p>
<ul class="simple">
<li>If you want to read the file, pass in <code class="docutils literal"><span class="pre">r</span></code></li>
<li>If you want to read and write the file, pass in <code class="docutils literal"><span class="pre">r+</span></code></li>
<li>If you want to overwrite the file, pass in <code class="docutils literal"><span class="pre">w</span></code></li>
<li>If you want to append to the file, pass in <code class="docutils literal"><span class="pre">a</span></code></li>
</ul>
<p>While there are a couple of other valid mode strings, chances are you
won’t ever use them. The mode matters not only because it changes the
behavior, but also because it may result in permission errors. For
example, if we were to open a jpg-file in a write-protected directory,
<code class="docutils literal"><span class="pre">open(..,</span> <span class="pre">'r+')</span></code> would fail. The mode can contain one further
character; we can open the file in binary (you’ll get a string of bytes)
or text mode (a string of characters).</p>
<p>In general, if the format is written by humans, it tends to be text
mode. <code class="docutils literal"><span class="pre">jpg</span></code> image files are not generally written by humans (and are
indeed not readable by humans), and you should therefore open them in
binary mode by adding a <code class="docutils literal"><span class="pre">b</span></code> to the mode string (if you’re following
the opening example, the correct mode would be <code class="docutils literal"><span class="pre">rb</span></code>). If you open
something in text mode (i.e. add a <code class="docutils literal"><span class="pre">t</span></code>, or nothing apart from
<code class="docutils literal"><span class="pre">r/r+/w/a</span></code>), you must also know which encoding to use. For a
computer, all files are just bytes, not characters.</p>
<p>Unfortunately, <code class="docutils literal"><span class="pre">open</span></code> does not allow explicit encoding specification
in Python 2.x. However, the function
<a class="reference external" href="http://docs.python.org/2/library/io.html#io.open">io.open</a> is
available in both Python 2.x and 3.x (where it is an alias of <code class="docutils literal"><span class="pre">open</span></code>),
and does the right thing. You can pass in the encoding with the
<code class="docutils literal"><span class="pre">encoding</span></code> keyword. If you don’t pass in any encoding, a system – and
Python – specific default will be picked. You may be tempted to rely on
these defaults, but the defaults are often wrong, or the default
encoding cannot actually express all characters in the file (this will happen often on
Python 2.x and/or Windows). So go ahead and pick an encoding. <code class="docutils literal"><span class="pre">utf-8</span></code>
is a terrific one. When you write a file, you can just pick the encoding
to your liking (or the liking of the program that will eventually read
your file).</p>
<p>How do you find out which encoding a file you’re reading was written in? Well,
unfortunately, there is no foolproof way to detect the encoding - the
same bytes can represent different, but equally valid characters in
different encodings. Therefore, you must rely on metadata (for example,
in HTTP headers) to know the encoding. Increasingly, formats just define
the encoding to be UTF-8.</p>
<p>Armed with this knowledge, let’s write a program that reads a file,
determines whether it’s JPG (hint: These files start with the bytes
<code class="docutils literal"><span class="pre">FF</span> <span class="pre">D8</span></code>), and writes a text file that describe the input file.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">io</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;photo.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">inf</span><span class="p">:</span>
    <span class="n">jpgdata</span> <span class="o">=</span> <span class="n">inf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

<span class="k">if</span> <span class="n">jpgdata</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\xff\xd8</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;This is a JPEG file (</span><span class="si">%d</span><span class="s1"> bytes long)</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">text</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;This is a random file (</span><span class="si">%d</span><span class="s1"> bytes long)</span><span class="se">\n</span><span class="s1">&#39;</span>

<span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;summary.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outf</span><span class="p">:</span>
    <span class="n">outf</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">jpgdata</span><span class="p">))</span>
</pre></div>
</div>
<p>I am sure that now you will use <code class="docutils literal"><span class="pre">open</span></code> correctly!</p>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="targeting_python_2_3.html" class="btn btn-neutral float-right" title="23. Targeting Python 2+3" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="python_c_extension.html" class="btn btn-neutral" title="21. Python C extensions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Muhammad Yasoob Ullah Khalid.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>